<!doctype html>
<html lang="ja">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- Boostrap 4 Toggle CSS -->
    <link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css" rel="stylesheet">

    <title>Parameter Chart</title>
  </head>
  <body>
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <a class="navbar-brand" href="#">NumParameters</a>
      </nav>
      <div class="container-fluid" >
        <div class="row">
            <div class="col-md-2 border-right" id="divToggleParent">
              <div>
                <input type="checkbox" data-toggle="toggle" data-size="xs" data-on="表示" data-off="非表示" checked>
                <span>alexnet</span>
              </div>
            </div>
            <div class="col-md-10">
                <h1>Parameter Chart</h1>
                <span>単位</span>
                <div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="customRadioInline0" name="customRadioInline" class="custom-control-input" checked> 
                    <label class="custom-control-label" for="customRadioInline0">なし</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="customRadioInline1" name="customRadioInline" class="custom-control-input">
                    <label class="custom-control-label" for="customRadioInline1">K</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" id="customRadioInline2" name="customRadioInline" class="custom-control-input">
                    <label class="custom-control-label" for="customRadioInline2">M</label>
                  </div>
                </div>


                <canvas id="myChart" width="1600" height="800"></canvas>
              </div>
            </div>
          </div>


      <!-- Optional JavaScript -->
      <!-- jQuery first, then Popper.js, then Bootstrap JS -->
      <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
      <!-- Boostrap 4 Toggle js -->
      <script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>
      <!-- chart.js -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.4/Chart.min.js"></script>
      <script>
          // function getRandomColor(){
          //   var letters = '0123456789ABCDEF';
          //   var color = '#';
          //   for (var i = 0; i < 6; i++) {
          //     color += letters[Math.floor(Math.random() * 16)];
          //   }
          //   return color;
          // }

      
          function initializeChart(model_names,num_parameters){
            var ctx = document.getElementById("myChart").getContext('2d');
            // var randomColors=Array.from({length:5},(k,v)=>getRandomColor());
            // var borderColors=randomColors.map(c=>c.a)

            var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels:model_names,
                datasets: [{
                  label: 'num parameters',
                  data: num_parameters,
                  // backgroundColor:randomColors
                }] 
            },
            options:{
              title:{
                display:true,
                text:"torchvision model num parameters"
              },
              scales:{
                yAxes:[{
                  ticks:{
                    beginAtZero:true
                  },
                  scaleLabel:{
                    display:true,
                    labelString:"パラメータ数",
                    fontSize:20,
                  }
                }],
                xAxes:[{
                  scaleLabel:{
                    display:true,
                    labelString:"モデル名",
                    fontSize:20,
                  }
                }]
              }
            }
            });
            return myChart;
          }

          
          function getJSON() {
              var req = new XMLHttpRequest();
              var json;
              req.onreadystatechange = function() {
                  if(req.readyState == 4 && req.status == 200){	
                      model_names=[];
                      num_parameters=[];			
                      var data = JSON.parse(req.responseText);	
                      var len = data.length;					
                      json=data;



                  }
              };
              req.open("GET", "model_parameters.json", false);			
              req.send(null);
              return json;
          }
          var json=getJSON();
          var model_names=[]
          var num_parameters=[]
          for(var i=0;i<json.length;i++){
            model_names.push(json[i].model_name);
            num_parameters.push(json[i].num_parameters);
          }


          var chart=initializeChart(model_names,num_parameters);
          
          $('input[name=customRadioInline]:radio').change(function(){
            var id_index=$(this).attr('id').slice(-1);
            console.log(id_index);
            if(id_index==0){
              // initializeChart(model_names,num_parameters);
              chart.data.datasets[0].data=num_parameters;
              chart.options.scales.yAxes[0].ticks.userCallback=(item)=>item;
            }else if(id_index==1){
              chart.data.datasets[0].data=num_parameters.map(x=>x/1000);
              chart.options.scales.yAxes[0].ticks.userCallback=(item)=>item+" K";
            }else if(id_index==2){
              chart.data.datasets[0].data=num_parameters.map(x=>x/1000000);
              chart.options.scales.yAxes[0].ticks.userCallback=(item)=>item+" M";
            }
            chart.update();
          });

          var isDataActive=[]
          model_names.forEach(item=>{
            isDataActive.push(true);
          });

          var toggleParent=$('#divToggleParent')
          
          for(var i=0;i<json.length;i++){
            model_name=json[i].model_name
            // toggleId=model_nam+"Toggle";
            toggleId="toggleId"+i;
            toggleParent.append('<div><input type="checkbox" id="'+toggleId+'" data-toggle="toggle" data-size="xs" data-on="表示" data-off="非表示" checked><span>'+model_name+'</span></div>');
            $(function(){
              $('#'+toggleId).change(function(){
                console.log(toggleId)
                // for(var li=0;li<char.data.labels.length;li++){
                //   console.log($('#'+toggleId+' ').next().text())
                //   if(chart.data.labels[i]===$('#'+toggleId+' ').next().text()){
                //     console.log("found")
                //     isDataActive[i]=false;

                //   }
                // }
                // chart.data.datasets[0].data[i]
                var model_name=$('#'+toggleId+' ').next().text()
                console.log(chart.data.labels)
                for(var cdi=0;chi<chart.data.labels.length;cdi++){
                  if(chart.data.labels[cdi]===model_name){
                    //remove item from chart
                    // var labels=chart.data.labels;
                    // chart.data.labels=labels;
                    // var data=chart.datasets[0].data
                    // data.splice(cdi,0);
                    // chart.datasets[0].data=data
                    chart.data.labels.splice(cdi,1);
                    chart.datasets[0].data.splice(cdi,1);

                    chart.update();
                  }
                }
                var val=$(this).val();
                console.log(val)
              })
            })
          }

      </script>
  </body>
</html>